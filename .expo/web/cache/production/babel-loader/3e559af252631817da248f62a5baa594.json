{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import Button from\"react-native-web/dist/exports/Button\";import React from\"react\";import{auth,db}from\"../../state/firebaseConfig\";import{loadStripe}from\"@stripe/stripe-js\";import firebase from\"firebase/app\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PlanUpdateTest=function PlanUpdateTest(){var sendToCheckout=function(){var _ref=_asyncToGenerator(function*(){yield db.collection(\"users\").doc(auth.currentUser.uid).collection(\"checkout_sessions\").add({price:\"price_1Mb4uSCIw3L7DOwI6exh9JBt\",success_url:window.location.origin,cancel_url:window.location.origin}).then(function(docRef){docRef.onSnapshot(function(){var _ref2=_asyncToGenerator(function*(snap){var _snap$data=snap.data(),error=_snap$data.error,sessionId=_snap$data.sessionId;if(error){alert(\"An error occurred: \"+error.message);}if(sessionId){var stripe=yield loadStripe(\"pk_live_51MHqrvCIw3L7DOwI0ol9CTCSH7mQXTLKpxTWKzmwOY1MdKwaYwhdJq6WTpkWdBeql3sS44JmybynlRnaO2nSa1FK001dHiEOZO\");console.log(\"redirecting\");yield stripe.redirectToCheckout({sessionId:sessionId});}});return function(_x){return _ref2.apply(this,arguments);};}());});});return function sendToCheckout(){return _ref.apply(this,arguments);};}();var Manage=function Manage(){firebase.functions().httpsCallable(\"ext-firestore-stripe-payments-createPortalLink\")({returnUrl:\"\"+window.location.origin,locale:\"auto\"}).then(function(response){console.log(response.data);window.location=response.data.url;}).catch(function(error){alert('Unknown error has occured: ',error);});};return _jsxs(View,{children:[_jsx(Text,{children:\"PlanUpdateTest\"}),_jsx(Button,{title:\"TEST\",onPress:sendToCheckout}),_jsx(Button,{title:\"Manage\",onPress:Manage})]});};export default PlanUpdateTest;","map":{"version":3,"names":["React","auth","db","loadStripe","firebase","PlanUpdateTest","sendToCheckout","collection","doc","currentUser","uid","add","price","success_url","window","location","origin","cancel_url","then","docRef","onSnapshot","snap","data","error","sessionId","alert","message","stripe","console","log","redirectToCheckout","Manage","functions","httpsCallable","returnUrl","locale","response","url","catch"],"sources":["/Users/peterputros/Desktop/PosMate/screens/authed/PlanUpdateTest.tsx"],"sourcesContent":["import { View, Text, Button } from \"react-native\";\nimport React from \"react\";\nimport { auth, db } from \"state/firebaseConfig\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport Axios from \"axios\";\nimport firebase from \"firebase/app\";\n\nconst PlanUpdateTest = () => {\n  const sendToCheckout = async () => {\n    await db\n      .collection(\"users\")\n      .doc(auth.currentUser.uid)\n      .collection(\"checkout_sessions\")\n      .add({\n        price: \"price_1Mb4uSCIw3L7DOwI6exh9JBt\", // todo price Id from your products price in the Stripe Dashboard\n        success_url: window.location.origin, // return user to this screen on successful purchase\n        cancel_url: window.location.origin, // return user to this screen on failed purchase\n      })\n      .then((docRef) => {\n        // Wait for the checkoutSession to get attached by the extension\n        docRef.onSnapshot(async (snap) => {\n          const { error, sessionId } = snap.data();\n          if (error) {\n            // Show an error to your customer and inspect\n            // your Cloud Function logs in the Firebase console.\n            alert(`An error occurred: ${error.message}`);\n          }\n\n          if (sessionId) {\n            // We have a session, let's redirect to Checkout\n            // Init Stripe\n            const stripe = await loadStripe(\n              \"pk_live_51MHqrvCIw3L7DOwI0ol9CTCSH7mQXTLKpxTWKzmwOY1MdKwaYwhdJq6WTpkWdBeql3sS44JmybynlRnaO2nSa1FK001dHiEOZO\" // todo enter your public stripe key here\n            );\n            console.log(`redirecting`);\n            await stripe.redirectToCheckout({ sessionId });\n          }\n        });\n      });\n  };\n\n  const Manage = () => {\n    firebase\n      .functions()\n      .httpsCallable(\"ext-firestore-stripe-payments-createPortalLink\")({\n        returnUrl: `${window.location.origin}`,\n        locale: \"auto\",\n      })\n      .then((response) => {\n          console.log(response.data);\n          window.location = response.data.url;\n      })\n      .catch((error) => {\n        alert('Unknown error has occured: ',error);\n      });\n    // var data = JSON.stringify({\n    //   email: email,\n    // });\n\n    // var config = {\n    //   method: \"post\",\n    //   maxBodyLength: Infinity,\n    //   url: \"https://us-central1-posmate-5fc0a.cloudfunctions.net/createPortalLink\",\n    //   headers: {\n    //     \"Content-Type\": \"application/json\",\n    //   },\n    //   //   data: data,\n    // };\n\n    // Axios(config)\n    //   .then(function (response) {\n    //     console.log(JSON.stringify(response.data));\n    //   })\n    //   .catch(function (error) {\n    //     console.log(error);\n    //   });\n  };\n\n  //   const sendToCustomerPortal = async () => {\n  //     // had to update firebase.app().functions() to firebase.default.functions() and\n  //     // removed the region from the functions call (from stripe firebase extension docs)\n  //     const functionRef = firebase\n  //       .functions()\n  //       .httpsCallable('ext-firestore-stripe-subscriptions-createPortalLink');\n  //     const { data } = await functionRef({ returnUrl: window.location.origin });\n  //     window.location.assign(data.url);\n  //   }\n\n  return (\n    <View>\n      <Text>PlanUpdateTest</Text>\n      <Button title=\"TEST\" onPress={sendToCheckout} />\n      <Button title=\"Manage\" onPress={Manage} />\n    </View>\n  );\n};\n\nexport default PlanUpdateTest;\n"],"mappings":"0OACA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,IAAI,CAAEC,EAAE,kCACjB,OAASC,UAAU,KAAQ,mBAAmB,CAE9C,MAAOC,SAAQ,KAAM,cAAc,CAAC,wFAEpC,GAAMC,eAAc,CAAG,QAAjBA,eAAc,EAAS,CAC3B,GAAMC,eAAc,uCAAG,WAAY,CACjC,KAAMJ,GAAE,CACLK,UAAU,CAAC,OAAO,CAAC,CACnBC,GAAG,CAACP,IAAI,CAACQ,WAAW,CAACC,GAAG,CAAC,CACzBH,UAAU,CAAC,mBAAmB,CAAC,CAC/BI,GAAG,CAAC,CACHC,KAAK,CAAE,gCAAgC,CACvCC,WAAW,CAAEC,MAAM,CAACC,QAAQ,CAACC,MAAM,CACnCC,UAAU,CAAEH,MAAM,CAACC,QAAQ,CAACC,MAC9B,CAAC,CAAC,CACDE,IAAI,CAAC,SAACC,MAAM,CAAK,CAEhBA,MAAM,CAACC,UAAU,wCAAC,UAAOC,IAAI,CAAK,CAChC,eAA6BA,IAAI,CAACC,IAAI,EAAE,CAAhCC,KAAK,YAALA,KAAK,CAAEC,SAAS,YAATA,SAAS,CACxB,GAAID,KAAK,CAAE,CAGTE,KAAK,uBAAuBF,KAAK,CAACG,OAAO,CAAG,CAC9C,CAEA,GAAIF,SAAS,CAAE,CAGb,GAAMG,OAAM,MAASxB,WAAU,CAC7B,6GAA6G,CAC9G,CACDyB,OAAO,CAACC,GAAG,eAAe,CAC1B,KAAMF,OAAM,CAACG,kBAAkB,CAAC,CAAEN,SAAS,CAATA,SAAU,CAAC,CAAC,CAChD,CACF,CAAC,+DAAC,CACJ,CAAC,CAAC,CACN,CAAC,iBA/BKlB,eAAc,0CA+BnB,CAED,GAAMyB,OAAM,CAAG,QAATA,OAAM,EAAS,CACnB3B,QAAQ,CACL4B,SAAS,EAAE,CACXC,aAAa,CAAC,gDAAgD,CAAC,CAAC,CAC/DC,SAAS,IAAKpB,MAAM,CAACC,QAAQ,CAACC,MAAQ,CACtCmB,MAAM,CAAE,MACV,CAAC,CAAC,CACDjB,IAAI,CAAC,SAACkB,QAAQ,CAAK,CAChBR,OAAO,CAACC,GAAG,CAACO,QAAQ,CAACd,IAAI,CAAC,CAC1BR,MAAM,CAACC,QAAQ,CAAGqB,QAAQ,CAACd,IAAI,CAACe,GAAG,CACvC,CAAC,CAAC,CACDC,KAAK,CAAC,SAACf,KAAK,CAAK,CAChBE,KAAK,CAAC,6BAA6B,CAACF,KAAK,CAAC,CAC5C,CAAC,CAAC,CAsBN,CAAC,CAYD,MACE,OAAC,IAAI,YACH,KAAC,IAAI,6BAAsB,CAC3B,KAAC,MAAM,EAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAEjB,cAAe,EAAG,CAChD,KAAC,MAAM,EAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAEyB,MAAO,EAAG,GACrC,CAEX,CAAC,CAED,cAAe1B,eAAc"},"metadata":{},"sourceType":"module"}