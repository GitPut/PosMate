{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import React,{useEffect,useState}from\"react\";import{Route,withRouter}from\"react-router-dom\";import index from\"../../Router/index\";import Header from\"./Header\";import Sidebar from\"./sidebar\";import{auth,db}from\"../../../../../state/firebaseConfig\";import{setTransListState,setTransListTableOrgState,woocommerceState}from\"../../../../../state/state\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var tz=require(\"moment-timezone\");var DefaultLayout=function DefaultLayout(props){var match=props.match;var wooCredentials=woocommerceState.use();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),transList=_useState2[0],setTransList=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),transListTableOrg=_useState4[0],setTransListTableOrg=_useState4[1];var getDate=function getDate(receipt){if(receipt.date_created){var dateString=receipt.date_created;var newDate=new Date(dateString+\"Z\");var targetTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone;var result=tz(newDate).tz(targetTimezone,true).format(\"YYYY-MM-DD HH:mm a\");return result;}else if(receipt.date){var _newDate=new Date(receipt.date.seconds*1000);var _targetTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone;var _result=tz(_newDate).tz(_targetTimezone,true).format(\"YYYY-MM-DD HH:mm a\");return _result;}};useEffect(function(){try{var _auth$currentUser;db.collection(\"users\").doc((_auth$currentUser=auth.currentUser)==null?void 0:_auth$currentUser.uid).collection(\"transList\").get().then(function(querySnapshot){querySnapshot.forEach(function(doc){var orderType=\"\";if(doc.data().method===\"deliveryOrder\"){orderType=\"Delivery\";}if(doc.data().method===\"pickupOrder\"){orderType=\"Pickup\";}if(doc.data().method===\"inStoreOrder\"){orderType=\"In Store\";}setTransList(function(prevState){return[].concat(_toConsumableArray(prevState),[doc.data()]);});setTransListTableOrg(function(prevState){var _doc$data$customer,_doc$data$customer2;return[].concat(_toConsumableArray(prevState),[_objectSpread(_objectSpread({},doc.data()),{},{id:doc.data().transNum.toUpperCase(),number:doc.data().transNum,name:(_doc$data$customer=doc.data().customer)!=null&&_doc$data$customer.name?(_doc$data$customer2=doc.data().customer)==null?void 0:_doc$data$customer2.name:\"N/A\",date:getDate(doc.data()),originalData:doc.data(),amount:doc.data().total,system:'POS',type:orderType})]);});});setTransListTableOrg(function(prevState){var newList=_toConsumableArray(prevState.sort(function(a,b){return new Date(b.originalData.date_created?b.originalData.date_created:b.originalData.date.seconds*1000)-new Date(a.originalData.date_created?a.originalData.date_created:a.originalData.date.seconds*1000);}));setTransList(newList);return newList;});});}catch(_unused){console.log(\"Error occured retrieving tranasctions\");}if(wooCredentials.useWoocommerce===true){try{var WooCommerceAPI=require(\"woocommerce-api\");var WooCommerce=new WooCommerceAPI({url:wooCredentials.apiUrl,consumerKey:wooCredentials.ck,consumerSecret:wooCredentials.cs,wpAPI:true,version:\"wc/v1\"});var page=1;var orders=[];var getOrders=function(){var _ref=_asyncToGenerator(function*(){var response=yield WooCommerce.getAsync(\"orders?page=\"+page+\"&per_page=100\");var data=JSON.parse(response.body);orders=[].concat(_toConsumableArray(orders),_toConsumableArray(data));if(data.length===100){page++;getOrders();}else{}});return function getOrders(){return _ref.apply(this,arguments);};}();getOrders().then(function(){return setTransList(function(prevState){return[].concat(_toConsumableArray(prevState),_toConsumableArray(orders));});}).catch(function(e){return console.log(\"error has occured\");});}catch(_unused2){console.log(\"Something occured with woo\");}}},[]);useEffect(function(){setTransListState(transList);setTransListTableOrgState(transListTableOrg);},[transList,transListTableOrg]);return _jsxs(_Fragment,{children:[_jsxs(\"div\",{className:\"main-wrapper\",children:[_jsx(Header,{}),_jsx(\"div\",{children:index&&index.map(function(route,key){return _jsx(Route,{path:match.url+\"/\"+route.path,component:route.component},key);})}),_jsx(Sidebar,{})]}),_jsx(\"div\",{className:\"sidebar-overlay\"})]});};export default withRouter(DefaultLayout);","map":{"version":3,"names":["React","useEffect","useState","Route","withRouter","index","Header","Sidebar","auth","db","setTransListState","setTransListTableOrgState","woocommerceState","tz","require","DefaultLayout","props","match","wooCredentials","use","transList","setTransList","transListTableOrg","setTransListTableOrg","getDate","receipt","date_created","dateString","newDate","Date","targetTimezone","Intl","DateTimeFormat","resolvedOptions","timeZone","result","format","date","seconds","collection","doc","currentUser","uid","get","then","querySnapshot","forEach","orderType","data","method","prevState","id","transNum","toUpperCase","number","name","customer","originalData","amount","total","system","type","newList","sort","a","b","console","log","useWoocommerce","WooCommerceAPI","WooCommerce","url","apiUrl","consumerKey","ck","consumerSecret","cs","wpAPI","version","page","orders","getOrders","response","getAsync","JSON","parse","body","length","catch","e","map","route","key","path","component"],"sources":["/Users/peterputros/Desktop/PosMate/pages/authed/main/InitialPage/Sidebar/DefaultLayout.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Route, withRouter } from \"react-router-dom\";\nimport index from \"../../Router/index\";\n\nimport Header from \"./Header\";\nimport Sidebar from \"./sidebar\";\nimport { auth, db } from \"state/firebaseConfig\";\nimport { setTransListState, setTransListTableOrgState, woocommerceState } from \"state/state\";\n\nconst tz = require(\"moment-timezone\");\n\nconst DefaultLayout = (props) => {\n  const { match } = props;\n\n  const wooCredentials = woocommerceState.use()\n  const [transList, setTransList] = useState([])\n  const [transListTableOrg, setTransListTableOrg] = useState([])\n\n  const getDate = (receipt) => {\n    if (receipt.date_created) {\n      const dateString = receipt.date_created;\n\n      const newDate = new Date(dateString + \"Z\");\n\n      const targetTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n      const result = tz(newDate)\n        .tz(targetTimezone, true)\n        .format(\"YYYY-MM-DD HH:mm a\");\n\n      return result;\n    } else if (receipt.date) {\n      const newDate = new Date(receipt.date.seconds * 1000);\n      const targetTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n      const result = tz(newDate)\n        .tz(targetTimezone, true)\n        .format(\"YYYY-MM-DD HH:mm a\");\n\n      return result;\n    }\n  };\n\n  useEffect(() => {\n    try {\n      db.collection(\"users\")\n        .doc(auth.currentUser?.uid)\n        .collection(\"transList\")\n        .get()\n        .then((querySnapshot) => {\n          querySnapshot.forEach((doc) => {\n            // doc.data() is never undefined for query doc snapshots\n            // console.log(doc.id, \" => \", doc.data());\n            let orderType = \"\";\n            if (doc.data().method === \"deliveryOrder\") {\n              orderType = \"Delivery\";\n            }\n            if (doc.data().method === \"pickupOrder\") {\n              orderType = \"Pickup\";\n            }\n            if (doc.data().method === \"inStoreOrder\") {\n              orderType = \"In Store\";\n            }\n\n            setTransList((prevState) => [...prevState, doc.data()]);\n            setTransListTableOrg((prevState) => [...prevState,\n            {\n              ...doc.data(),\n              id: doc.data().transNum.toUpperCase(),\n              number: doc.data().transNum,\n              name: doc.data().customer?.name ? doc.data().customer?.name : \"N/A\",\n              date: getDate(doc.data()),\n              originalData: doc.data(),\n              amount: doc.data().total,\n              system: 'POS',\n              type: orderType,\n            }\n            ]);\n          });\n          //sort by date\n          setTransListTableOrg((prevState) => {\n            const newList = [...prevState.sort((a, b) => new Date(b.originalData.date_created ? b.originalData.date_created : b.originalData.date.seconds * 1000) - new Date(a.originalData.date_created ? a.originalData.date_created : a.originalData.date.seconds * 1000))]\n            setTransList(newList)\n\n            return newList\n          })\n\n        });\n    } catch {\n      console.log(\"Error occured retrieving tranasctions\");\n    }\n\n    if (wooCredentials.useWoocommerce === true) {\n      try {\n        const WooCommerceAPI = require(\"woocommerce-api\");\n\n        const WooCommerce = new WooCommerceAPI({\n          url: wooCredentials.apiUrl,\n          consumerKey: wooCredentials.ck,\n          consumerSecret: wooCredentials.cs,\n          wpAPI: true,\n          version: \"wc/v1\",\n        });\n\n        let page = 1;\n        let orders = [];\n\n        const getOrders = async () => {\n          const response = await WooCommerce.getAsync(\n            `orders?page=${page}&per_page=100`\n          );\n          const data = JSON.parse(response.body);\n          orders = [...orders, ...data];\n          if (data.length === 100) {\n            page++;\n            getOrders();\n          } else {\n            // console.log(orders);\n          }\n        };\n\n        getOrders()\n          .then(() => setTransList((prevState) => [...prevState, ...orders]))\n          .catch((e) => console.log(\"error has occured\"));\n      } catch {\n        console.log(\"Something occured with woo\");\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    setTransListState(transList)\n    setTransListTableOrgState(transListTableOrg)\n  }, [transList, transListTableOrg])\n\n\n  return (\n    <>\n      <div className=\"main-wrapper\">\n        <Header />\n        <div>\n          {index &&\n            index.map((route, key) => (\n              <Route\n                key={key}\n                path={`${match.url}/${route.path}`}\n                component={route.component}\n              />\n            ))}\n        </div>\n        <Sidebar />\n      </div>\n      <div className=\"sidebar-overlay\"></div>\n    </>\n  );\n}\n\nexport default withRouter(DefaultLayout);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}