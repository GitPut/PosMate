{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState } from \"react\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport MainAuthed from \"./authed/MainAuthed\";\nimport { setTransListState, setUserState, setUserStoreState, setWoocommerceState, transListState, userState, woocommerceState } from \"../state/state\";\nimport MainNonAuth from \"./non-authed/MainNonAuth\";\nimport { auth, db } from \"../state/firebaseConfig\";\nimport Spinner from \"../components/Spinner\";\nimport { updateTransList } from \"../state/firebaseFunctions\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar RouteManager = function RouteManager() {\n  var userS = userState.use();\n  var wooCredentials = woocommerceState.use();\n  var transList = transListState.use();\n  var _useState = useState(transList),\n    _useState2 = _slicedToArray(_useState, 2),\n    savedTranslist = _useState2[0],\n    setsavedTranslist = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setloading = _useState4[1];\n  useEffect(function () {\n    auth.onAuthStateChanged(function (user) {\n      if (user) {\n        setUserState(user);\n        db.collection(\"users\").doc(user.uid).get().then(function (doc) {\n          setUserStoreState({\n            products: doc.data().products,\n            categories: doc.data().categories\n          });\n          if (doc.data().transList) {\n            setTransListState(doc.data().transList);\n          }\n          if (doc.data().wooCredentials) {\n            setWoocommerceState(doc.data().wooCredentials);\n          }\n        });\n        setTimeout(function () {\n          setloading(false);\n        }, 1);\n      } else {\n        setUserState(null);\n        setUserStoreState({\n          products: null,\n          categories: null\n        });\n        setTimeout(function () {\n          setloading(false);\n        }, 1);\n      }\n    });\n  }, []);\n  useEffect(function () {\n    if (userS) {\n      var unsub = db.collection(\"users\").doc(userS.uid).onSnapshot(function (doc) {\n        setloading(true);\n        setUserStoreState({\n          products: doc.data().products,\n          categories: doc.data().categories\n        });\n        setTransListState(doc.data().transList);\n        setTimeout(function () {\n          setloading(false);\n        }, 1);\n      });\n      return function () {\n        return unsub();\n      };\n    }\n  }, [userS]);\n  useEffect(function () {\n    console.log(transList);\n    if (wooCredentials.useWoocommerce === true) {\n      var interval = setInterval(function () {\n        fetch(wooCredentials.apiUrl, {\n          headers: {\n            Authorization: \"Basic \" + btoa(wooCredentials.ck + \":\" + wooCredentials.cs)\n          }\n        }).then(function (response) {\n          return response.json();\n        }).then(function (data) {\n\n          var array1 = transList;\n          var array2 = data;\n          var newArray = [];\n          array1.concat(array2).reduce(function (acc, curr) {\n            if (!acc.includes(curr.transaction_id)) {\n              acc.push(curr.transaction_id);\n              newArray.push(curr);\n            }\n            return acc;\n          }, []);\n          if (newArray.length > transList.length) {\n            var newItems = structuredClone(newArray).splice(transList.length, newArray.length - transList.length);\n            console.log(\"NewItems Test: \", newItems);\n            console.log(\"Tested newArray: \", newArray);\n\n            updateTransList(newArray);\n          }\n        }).catch(function (error) {\n          alert(\"Error has errored with woocommerce api. Try refreshing or updating creditials\");\n          clearInterval(interval);\n        });\n      }, 5000);\n      return function () {\n        return clearInterval(interval);\n      };\n    }\n  }, [wooCredentials, transList]);\n  return _jsx(NavigationContainer, {\n    children: loading ? _jsx(Spinner, {\n      isModalVisible: true\n    }) : _jsx(_Fragment, {\n      children: userS ? _jsx(MainAuthed, {}) : _jsx(MainNonAuth, {})\n    })\n  });\n};\nexport default RouteManager;","map":{"version":3,"names":["React","useEffect","useState","NavigationContainer","MainAuthed","setTransListState","setUserState","setUserStoreState","setWoocommerceState","transListState","userState","woocommerceState","MainNonAuth","auth","db","Spinner","updateTransList","RouteManager","userS","use","wooCredentials","transList","savedTranslist","setsavedTranslist","loading","setloading","onAuthStateChanged","user","collection","doc","uid","get","then","products","data","categories","setTimeout","unsub","onSnapshot","console","log","useWoocommerce","interval","setInterval","fetch","apiUrl","headers","Authorization","btoa","ck","cs","response","json","array1","array2","newArray","concat","reduce","acc","curr","includes","transaction_id","push","length","newItems","structuredClone","splice","catch","error","alert","clearInterval"],"sources":["/Users/peterputros/Desktop/PosMate-1/navigation/RouteManager.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport MainAuthed from \"./authed/MainAuthed\";\nimport {\n  setTransListState,\n  setUserState,\n  setUserStoreState,\n  setWoocommerceState,\n  transListState,\n  userState,\n  woocommerceState,\n} from \"state/state\";\nimport MainNonAuth from \"./non-authed/MainNonAuth\";\nimport { auth, db } from \"state/firebaseConfig\";\nimport Spinner from \"components/Spinner\";\nimport { updateTransList } from \"state/firebaseFunctions\";\n\nconst RouteManager = () => {\n  const userS = userState.use();\n  const wooCredentials = woocommerceState.use();\n  const transList = transListState.use();\n  const [savedTranslist, setsavedTranslist] = useState(transList);\n  const [loading, setloading] = useState(true);\n\n  useEffect(() => {\n    auth.onAuthStateChanged((user) => {\n      if (user) {\n        setUserState(user);\n        db.collection(\"users\")\n          .doc(user.uid)\n          .get()\n          .then((doc) => {\n            setUserStoreState({\n              products: doc.data().products,\n              categories: doc.data().categories,\n            });\n            if (doc.data().transList) {\n              setTransListState(doc.data().transList);\n            }\n            if (doc.data().wooCredentials) {\n              setWoocommerceState(doc.data().wooCredentials);\n            }\n          });\n        setTimeout(() => {\n          setloading(false);\n        }, 1);\n      } else {\n        setUserState(null);\n        setUserStoreState({ products: null, categories: null });\n        setTimeout(() => {\n          setloading(false);\n        }, 1);\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    if (userS) {\n      const unsub = db\n        .collection(\"users\")\n        .doc(userS.uid)\n        .onSnapshot((doc) => {\n          setloading(true);\n          setUserStoreState({\n            products: doc.data().products,\n            categories: doc.data().categories,\n          });\n          setTransListState(doc.data().transList);\n          setTimeout(() => {\n            setloading(false);\n          }, 1);\n        });\n      return () => unsub();\n    }\n  }, [userS]);\n\n  useEffect(() => {\n    console.log(transList)\n    if (wooCredentials.useWoocommerce === true) {\n      const interval = setInterval(() => {\n        fetch(wooCredentials.apiUrl, {\n          headers: {\n            Authorization:\n              \"Basic \" + btoa(`${wooCredentials.ck}:${wooCredentials.cs}`),\n          },\n        })\n          .then((response) => response.json())\n          .then((data) => {\n            // do something with the data, like checking for new orders\n            //console.log(data);\n\n            const array1 = transList;\n            const array2 = data;\n\n            const newArray = [];\n\n            array1.concat(array2).reduce(function (acc, curr) {\n              if (!acc.includes(curr.transaction_id)) {\n                acc.push(curr.transaction_id);\n                newArray.push(curr);\n              }\n              return acc;\n            }, []);\n            if (newArray.length > transList.length) {\n              const newItems = structuredClone(newArray).splice(\n                transList.length,\n                newArray.length - transList.length\n              );\n\n              console.log(\"NewItems Test: \", newItems);\n              console.log(\"Tested newArray: \", newArray);\n\n              // if (newItems.length > 1) {\n              //   newItems.forEach((e) => {\n              //     const printData = { printData: e.transaction_id };\n              //     fetch(\"http://localhost:8080/print\", {\n              //       method: \"POST\",\n              //       headers: {\n              //         \"Content-Type\": \"application/json\",\n              //       },\n              //       body: JSON.stringify(printData),\n              //     })\n              //       .then((response) => response.json())\n              //       .then((respData) => {\n              //         console.log(respData);\n              //       });\n              //   });\n              // } else {\n              //       const printData = [\n              //         \"\\x1B\" + \"\\x40\", // init\n              //         \"\\x1B\" + \"\\x61\" + \"\\x31\", // center align\n              //         \"Dream City Pizza\",\n              //         \"\\x0A\",\n              //         \"#B4-200 Preston Pkwy, Cambridge\" + \"\\x0A\",\n              //         \"www.dreamcitypizza.com\" + \"\\x0A\", // text and line break\n              //         \"(519) 650-0409\" + \"\\x0A\", // text and line break\n              //         \"\\x1B\" + \"\\x61\" + \"\\x30\", // left align\n              //       ];\n\n              //   newItems[0].line_items.forEach(element => {\n              // data.push(\"\\x0A\");\n              // data.push(\"\\x0A\");\n              //     printData.push('Name: ', element.name)\n              //     data.push(\"\\x0A\");\n              //     printData.push(\"Quantity: \", element.quantity);\n              //     data.push(\"\\x0A\");\n              // element.meta_data.forEach(meta => {\n              //     printData.push(`${meta.key} : ${meta.value}`)\n              //     data.push(\"\\x0A\");\n              //       })\n              //       })\n\n              //       data.push(\n              //         \"\\x0A\", // line break\n              //         \"\\x0A\", // line break\n              //         \"\\x0A\", // line break\n              //         \"\\x0A\", // line break\n              //         \"\\x0A\", // line break\n              //         \"\\x0A\", // line break\n              //         \"\\x1D\" + \"\\x56\" + \"\\x30\"\n              //       );\n\n              //    data.push(\n              //       \"\\x1B\" + \"\\x40\", // init\n              //       \"\\x1B\" + \"\\x61\" + \"\\x31\", // center align\n              //       \"Tomas Pizza\",\n              //       \"\\x0A\",\n              //       \"#B4-200 Preston Pkwy, Cambridge\" + \"\\x0A\",\n              //       \"www.dreamcitypizza.com\" + \"\\x0A\", // text and line break\n              //       \"(519) 650-0409\" + \"\\x0A\", // text and line break\n              //       e.date_created + \"\\x0A\",\n              //       \"\\x0A\",\n              //       \"Online Order\" + \"\\x0A\", // text and line break\n              //       `Transaction # ${e.number}` + \"\\x0A\",\n              //       \"\\x0A\",\n              //       \"\\x0A\",\n              //       \"\\x0A\",\n              //       \"\\x1B\" + \"\\x61\" + \"\\x30\" // left align\n              //     );\n\n              //     e.line_items?.map((cartItem) => {\n              //       data.push(`Name: ${cartItem.name}`);\n              //       data.push(\"\\x0A\");\n              //       data.push(`Quantity: ${cartItem.quantity}`);\n              //       data.push(\"\\x0A\");\n              //       data.push(`Price: $${cartItem.price}`);\n\n              //       if (cartItem.options) {\n              //         cartItem.options?.map((option) => {\n              //           data.push(option);\n              //           data.push(\"\\x0A\");\n              //         });\n              //       } else {\n              //         data.push(\"\\x0A\" + \"\\x0A\");\n              //       }\n              //     });\n\n              //     data.push(\n              //       \"\\x0A\",\n              //       \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\" + \"\\x0A\",\n              //       \"\\x0A\" + \"\\x0A\",\n              //       \"Payment Method: \" + element.method + \"\\x0A\" + \"\\x0A\",\n              //       \"Total Including (13% Tax): \" + \"$\" + element.total + \"\\x0A\" + \"\\x0A\",\n              //       \"------------------------------------------\" + \"\\x0A\",\n              //       \"\\x0A\", // line break\n              //       \"\\x0A\", // line break\n              //       \"\\x0A\", // line break\n              //       \"\\x0A\", // line break\n              //       \"\\x0A\", // line break\n              //       \"\\x0A\" // line break\n              //     );\n              //   });\n\n              //   data.push(\"\\x1D\" + \"\\x56\" + \"\\x00\", \"\\x1D\" + \"\\x56\" + \"\\x30\");\n\n              //   fetch(\"http://localhost:8080/print\", {\n              //     method: \"POST\",\n              //     headers: {\n              //       \"Content-Type\": \"application/json\",\n              //     },\n              //     body: JSON.stringify(printData),\n              //   })\n              //     .then((response) => response.json())\n              //     .then((respData) => {\n              //       console.log(respData);\n              //     });\n              //}\n              updateTransList(newArray);\n            }\n          })\n          .catch((error) => {\n            alert(\n              \"Error has errored with woocommerce api. Try refreshing or updating creditials\"\n            );\n            clearInterval(interval);\n          });\n      }, 5000); // this will check for new orders every minute\n      return () => clearInterval(interval);\n    }\n  }, [wooCredentials, transList]);\n\n  return (\n    <NavigationContainer>\n      {loading ? (\n        <Spinner isModalVisible={true} />\n      ) : (\n        <>{userS ? <MainAuthed /> : <MainNonAuth />}</>\n      )}\n    </NavigationContainer>\n  );\n};\n\nexport default RouteManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}