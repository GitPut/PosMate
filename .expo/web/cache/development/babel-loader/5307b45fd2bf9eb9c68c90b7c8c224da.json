{"ast":null,"code":"\n\n(function ($) {\n\n  var REDRAW_ATTEMPTS = 10;\n\n  var REDRAW_SHRINK = 0.95;\n  function init(plot) {\n    var canvas = null,\n      target = null,\n      options = null,\n      maxRadius = null,\n      centerLeft = null,\n      centerTop = null,\n      processed = false,\n      ctx = null;\n\n    var highlights = [];\n\n    plot.hooks.processOptions.push(function (plot, options) {\n      if (options.series.pie.show) {\n        options.grid.show = false;\n\n        if (options.series.pie.label.show == \"auto\") {\n          if (options.legend.show) {\n            options.series.pie.label.show = false;\n          } else {\n            options.series.pie.label.show = true;\n          }\n        }\n\n        if (options.series.pie.radius == \"auto\") {\n          if (options.series.pie.label.show) {\n            options.series.pie.radius = 3 / 4;\n          } else {\n            options.series.pie.radius = 1;\n          }\n        }\n\n        if (options.series.pie.tilt > 1) {\n          options.series.pie.tilt = 1;\n        } else if (options.series.pie.tilt < 0) {\n          options.series.pie.tilt = 0;\n        }\n      }\n    });\n    plot.hooks.bindEvents.push(function (plot, eventHolder) {\n      var options = plot.getOptions();\n      if (options.series.pie.show) {\n        if (options.grid.hoverable) {\n          eventHolder.unbind(\"mousemove\").mousemove(onMouseMove);\n        }\n        if (options.grid.clickable) {\n          eventHolder.unbind(\"click\").click(onClick);\n        }\n      }\n    });\n    plot.hooks.processDatapoints.push(function (plot, series, data, datapoints) {\n      var options = plot.getOptions();\n      if (options.series.pie.show) {\n        processDatapoints(plot, series, data, datapoints);\n      }\n    });\n    plot.hooks.drawOverlay.push(function (plot, octx) {\n      var options = plot.getOptions();\n      if (options.series.pie.show) {\n        drawOverlay(plot, octx);\n      }\n    });\n    plot.hooks.draw.push(function (plot, newCtx) {\n      var options = plot.getOptions();\n      if (options.series.pie.show) {\n        draw(plot, newCtx);\n      }\n    });\n    function processDatapoints(plot, series, datapoints) {\n      if (!processed) {\n        processed = true;\n        canvas = plot.getCanvas();\n        target = $(canvas).parent();\n        options = plot.getOptions();\n        plot.setData(combine(plot.getData()));\n      }\n    }\n    function combine(data) {\n      var total = 0,\n        combined = 0,\n        numCombined = 0,\n        color = options.series.pie.combine.color,\n        newdata = [];\n\n      for (var i = 0; i < data.length; ++i) {\n        var value = data[i].data;\n\n        if ($.isArray(value) && value.length == 1) {\n          value = value[0];\n        }\n        if ($.isArray(value)) {\n          if (!isNaN(parseFloat(value[1])) && isFinite(value[1])) {\n            value[1] = +value[1];\n          } else {\n            value[1] = 0;\n          }\n        } else if (!isNaN(parseFloat(value)) && isFinite(value)) {\n          value = [1, +value];\n        } else {\n          value = [1, 0];\n        }\n        data[i].data = [value];\n      }\n\n      for (var i = 0; i < data.length; ++i) {\n        total += data[i].data[0][1];\n      }\n\n      for (var i = 0; i < data.length; ++i) {\n        var value = data[i].data[0][1];\n        if (value / total <= options.series.pie.combine.threshold) {\n          combined += value;\n          numCombined++;\n          if (!color) {\n            color = data[i].color;\n          }\n        }\n      }\n      for (var i = 0; i < data.length; ++i) {\n        var value = data[i].data[0][1];\n        if (numCombined < 2 || value / total > options.series.pie.combine.threshold) {\n          newdata.push($.extend(data[i], {\n            data: [[1, value]],\n            color: data[i].color,\n            label: data[i].label,\n            angle: value * Math.PI * 2 / total,\n            percent: value / (total / 100)\n          }));\n        }\n      }\n      if (numCombined > 1) {\n        newdata.push({\n          data: [[1, combined]],\n          color: color,\n          label: options.series.pie.combine.label,\n          angle: combined * Math.PI * 2 / total,\n          percent: combined / (total / 100)\n        });\n      }\n      return newdata;\n    }\n    function draw(plot, newCtx) {\n      if (!target) {\n        return;\n      }\n\n      var canvasWidth = plot.getPlaceholder().width(),\n        canvasHeight = plot.getPlaceholder().height(),\n        legendWidth = target.children().filter(\".legend\").children().width() || 0;\n      ctx = newCtx;\n\n      processed = false;\n\n      maxRadius = Math.min(canvasWidth, canvasHeight / options.series.pie.tilt) / 2;\n      centerTop = canvasHeight / 2 + options.series.pie.offset.top;\n      centerLeft = canvasWidth / 2;\n      if (options.series.pie.offset.left == \"auto\") {\n        if (options.legend.position.match(\"w\")) {\n          centerLeft += legendWidth / 2;\n        } else {\n          centerLeft -= legendWidth / 2;\n        }\n        if (centerLeft < maxRadius) {\n          centerLeft = maxRadius;\n        } else if (centerLeft > canvasWidth - maxRadius) {\n          centerLeft = canvasWidth - maxRadius;\n        }\n      } else {\n        centerLeft += options.series.pie.offset.left;\n      }\n      var slices = plot.getData(),\n        attempts = 0;\n\n      do {\n        if (attempts > 0) {\n          maxRadius *= REDRAW_SHRINK;\n        }\n        attempts += 1;\n        clear();\n        if (options.series.pie.tilt <= 0.8) {\n          drawShadow();\n        }\n      } while (!drawPie() && attempts < REDRAW_ATTEMPTS);\n      if (attempts >= REDRAW_ATTEMPTS) {\n        clear();\n        target.prepend(\"<div class='error'>Could not draw pie with labels contained inside canvas</div>\");\n      }\n      if (plot.setSeries && plot.insertLegend) {\n        plot.setSeries(slices);\n        plot.insertLegend();\n      }\n\n      function clear() {\n        ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n        target.children().filter(\".pieLabel, .pieLabelBackground\").remove();\n      }\n      function drawShadow() {\n        var shadowLeft = options.series.pie.shadow.left;\n        var shadowTop = options.series.pie.shadow.top;\n        var edge = 10;\n        var alpha = options.series.pie.shadow.alpha;\n        var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\n        if (radius >= canvasWidth / 2 - shadowLeft || radius * options.series.pie.tilt >= canvasHeight / 2 - shadowTop || radius <= edge) {\n          return;\n        }\n\n        ctx.save();\n        ctx.translate(shadowLeft, shadowTop);\n        ctx.globalAlpha = alpha;\n        ctx.fillStyle = \"#000\";\n\n        ctx.translate(centerLeft, centerTop);\n        ctx.scale(1, options.series.pie.tilt);\n\n        for (var i = 1; i <= edge; i++) {\n          ctx.beginPath();\n          ctx.arc(0, 0, radius, 0, Math.PI * 2, false);\n          ctx.fill();\n          radius -= i;\n        }\n        ctx.restore();\n      }\n      function drawPie() {\n        var startAngle = Math.PI * options.series.pie.startAngle;\n        var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\n\n        ctx.save();\n        ctx.translate(centerLeft, centerTop);\n        ctx.scale(1, options.series.pie.tilt);\n\n        ctx.save();\n        var currentAngle = startAngle;\n        for (var i = 0; i < slices.length; ++i) {\n          slices[i].startAngle = currentAngle;\n          drawSlice(slices[i].angle, slices[i].color, true);\n        }\n        ctx.restore();\n\n        if (options.series.pie.stroke.width > 0) {\n          ctx.save();\n          ctx.lineWidth = options.series.pie.stroke.width;\n          currentAngle = startAngle;\n          for (var i = 0; i < slices.length; ++i) {\n            drawSlice(slices[i].angle, options.series.pie.stroke.color, false);\n          }\n          ctx.restore();\n        }\n\n        drawDonutHole(ctx);\n        ctx.restore();\n\n        if (options.series.pie.label.show) {\n          return drawLabels();\n        } else return true;\n        function drawSlice(angle, color, fill) {\n          if (angle <= 0 || isNaN(angle)) {\n            return;\n          }\n          if (fill) {\n            ctx.fillStyle = color;\n          } else {\n            ctx.strokeStyle = color;\n            ctx.lineJoin = \"round\";\n          }\n          ctx.beginPath();\n          if (Math.abs(angle - Math.PI * 2) > 0.000000001) {\n            ctx.moveTo(0, 0);\n          }\n\n          ctx.arc(0, 0, radius, currentAngle, currentAngle + angle / 2, false);\n          ctx.arc(0, 0, radius, currentAngle + angle / 2, currentAngle + angle, false);\n          ctx.closePath();\n          currentAngle += angle;\n          if (fill) {\n            ctx.fill();\n          } else {\n            ctx.stroke();\n          }\n        }\n        function drawLabels() {\n          var currentAngle = startAngle;\n          var radius = options.series.pie.label.radius > 1 ? options.series.pie.label.radius : maxRadius * options.series.pie.label.radius;\n          for (var i = 0; i < slices.length; ++i) {\n            if (slices[i].percent >= options.series.pie.label.threshold * 100) {\n              if (!drawLabel(slices[i], currentAngle, i)) {\n                return false;\n              }\n            }\n            currentAngle += slices[i].angle;\n          }\n          return true;\n          function drawLabel(slice, startAngle, index) {\n            if (slice.data[0][1] == 0) {\n              return true;\n            }\n\n            var lf = options.legend.labelFormatter,\n              text,\n              plf = options.series.pie.label.formatter;\n            if (lf) {\n              text = lf(slice.label, slice);\n            } else {\n              text = slice.label;\n            }\n            if (plf) {\n              text = plf(text, slice);\n            }\n            var halfAngle = (startAngle + slice.angle + startAngle) / 2;\n            var x = centerLeft + Math.round(Math.cos(halfAngle) * radius);\n            var y = centerTop + Math.round(Math.sin(halfAngle) * radius) * options.series.pie.tilt;\n            var html = \"<span class='pieLabel' id='pieLabel\" + index + \"' style='position:absolute;top:\" + y + \"px;left:\" + x + \"px;'>\" + text + \"</span>\";\n            target.append(html);\n            var label = target.children(\"#pieLabel\" + index);\n            var labelTop = y - label.height() / 2;\n            var labelLeft = x - label.width() / 2;\n            label.css(\"top\", labelTop);\n            label.css(\"left\", labelLeft);\n\n            if (0 - labelTop > 0 || 0 - labelLeft > 0 || canvasHeight - (labelTop + label.height()) < 0 || canvasWidth - (labelLeft + label.width()) < 0) {\n              return false;\n            }\n            if (options.series.pie.label.background.opacity != 0) {\n\n              var c = options.series.pie.label.background.color;\n              if (c == null) {\n                c = slice.color;\n              }\n              var pos = \"top:\" + labelTop + \"px;left:\" + labelLeft + \"px;\";\n              $(\"<div class='pieLabelBackground' style='position:absolute;width:\" + label.width() + \"px;height:\" + label.height() + \"px;\" + pos + \"background-color:\" + c + \";'></div>\").css(\"opacity\", options.series.pie.label.background.opacity).insertBefore(label);\n            }\n            return true;\n          }\n        }\n      }\n    }\n\n    function drawDonutHole(layer) {\n      if (options.series.pie.innerRadius > 0) {\n\n        layer.save();\n        var innerRadius = options.series.pie.innerRadius > 1 ? options.series.pie.innerRadius : maxRadius * options.series.pie.innerRadius;\n        layer.globalCompositeOperation = \"destination-out\";\n        layer.beginPath();\n        layer.fillStyle = options.series.pie.stroke.color;\n        layer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);\n        layer.fill();\n        layer.closePath();\n        layer.restore();\n\n        layer.save();\n        layer.beginPath();\n        layer.strokeStyle = options.series.pie.stroke.color;\n        layer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);\n        layer.stroke();\n        layer.closePath();\n        layer.restore();\n\n      }\n    }\n\n    function isPointInPoly(poly, pt) {\n      for (var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i) {\n        (poly[i][1] <= pt[1] && pt[1] < poly[j][1] || poly[j][1] <= pt[1] && pt[1] < poly[i][1]) && pt[0] < (poly[j][0] - poly[i][0]) * (pt[1] - poly[i][1]) / (poly[j][1] - poly[i][1]) + poly[i][0] && (c = !c);\n      }\n      return c;\n    }\n    function findNearbySlice(mouseX, mouseY) {\n      var slices = plot.getData(),\n        options = plot.getOptions(),\n        radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius,\n        x,\n        y;\n      for (var i = 0; i < slices.length; ++i) {\n        var s = slices[i];\n        if (s.pie.show) {\n          ctx.save();\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.arc(0, 0, radius, s.startAngle, s.startAngle + s.angle / 2, false);\n          ctx.arc(0, 0, radius, s.startAngle + s.angle / 2, s.startAngle + s.angle, false);\n          ctx.closePath();\n          x = mouseX - centerLeft;\n          y = mouseY - centerTop;\n          if (ctx.isPointInPath) {\n            if (ctx.isPointInPath(mouseX - centerLeft, mouseY - centerTop)) {\n              ctx.restore();\n              return {\n                datapoint: [s.percent, s.data],\n                dataIndex: 0,\n                series: s,\n                seriesIndex: i\n              };\n            }\n          } else {\n\n            var p1X = radius * Math.cos(s.startAngle),\n              p1Y = radius * Math.sin(s.startAngle),\n              p2X = radius * Math.cos(s.startAngle + s.angle / 4),\n              p2Y = radius * Math.sin(s.startAngle + s.angle / 4),\n              p3X = radius * Math.cos(s.startAngle + s.angle / 2),\n              p3Y = radius * Math.sin(s.startAngle + s.angle / 2),\n              p4X = radius * Math.cos(s.startAngle + s.angle / 1.5),\n              p4Y = radius * Math.sin(s.startAngle + s.angle / 1.5),\n              p5X = radius * Math.cos(s.startAngle + s.angle),\n              p5Y = radius * Math.sin(s.startAngle + s.angle),\n              arrPoly = [[0, 0], [p1X, p1Y], [p2X, p2Y], [p3X, p3Y], [p4X, p4Y], [p5X, p5Y]],\n              arrPoint = [x, y];\n\n            if (isPointInPoly(arrPoly, arrPoint)) {\n              ctx.restore();\n              return {\n                datapoint: [s.percent, s.data],\n                dataIndex: 0,\n                series: s,\n                seriesIndex: i\n              };\n            }\n          }\n          ctx.restore();\n        }\n      }\n      return null;\n    }\n    function onMouseMove(e) {\n      triggerClickHoverEvent(\"plothover\", e);\n    }\n    function onClick(e) {\n      triggerClickHoverEvent(\"plotclick\", e);\n    }\n\n    function triggerClickHoverEvent(eventname, e) {\n      var offset = plot.offset();\n      var canvasX = parseInt(e.pageX - offset.left);\n      var canvasY = parseInt(e.pageY - offset.top);\n      var item = findNearbySlice(canvasX, canvasY);\n      if (options.grid.autoHighlight) {\n\n        for (var i = 0; i < highlights.length; ++i) {\n          var h = highlights[i];\n          if (h.auto == eventname && !(item && h.series == item.series)) {\n            unhighlight(h.series);\n          }\n        }\n      }\n\n      if (item) {\n        highlight(item.series, eventname);\n      }\n\n      var pos = {\n        pageX: e.pageX,\n        pageY: e.pageY\n      };\n      target.trigger(eventname, [pos, item]);\n    }\n    function highlight(s, auto) {\n\n      var i = indexOfHighlight(s);\n      if (i == -1) {\n        highlights.push({\n          series: s,\n          auto: auto\n        });\n        plot.triggerRedrawOverlay();\n      } else if (!auto) {\n        highlights[i].auto = false;\n      }\n    }\n    function unhighlight(s) {\n      if (s == null) {\n        highlights = [];\n        plot.triggerRedrawOverlay();\n      }\n\n      var i = indexOfHighlight(s);\n      if (i != -1) {\n        highlights.splice(i, 1);\n        plot.triggerRedrawOverlay();\n      }\n    }\n    function indexOfHighlight(s) {\n      for (var i = 0; i < highlights.length; ++i) {\n        var h = highlights[i];\n        if (h.series == s) return i;\n      }\n      return -1;\n    }\n    function drawOverlay(plot, octx) {\n      var options = plot.getOptions();\n      var radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\n      octx.save();\n      octx.translate(centerLeft, centerTop);\n      octx.scale(1, options.series.pie.tilt);\n      for (var i = 0; i < highlights.length; ++i) {\n        drawHighlight(highlights[i].series);\n      }\n      drawDonutHole(octx);\n      octx.restore();\n      function drawHighlight(series) {\n        if (series.angle <= 0 || isNaN(series.angle)) {\n          return;\n        }\n\n        octx.fillStyle = \"rgba(255, 255, 255, \" + options.series.pie.highlight.opacity + \")\";\n        octx.beginPath();\n        if (Math.abs(series.angle - Math.PI * 2) > 0.000000001) {\n          octx.moveTo(0, 0);\n        }\n\n        octx.arc(0, 0, radius, series.startAngle, series.startAngle + series.angle / 2, false);\n        octx.arc(0, 0, radius, series.startAngle + series.angle / 2, series.startAngle + series.angle, false);\n        octx.closePath();\n        octx.fill();\n      }\n    }\n  }\n\n  var options = {\n    series: {\n      pie: {\n        show: false,\n        radius: \"auto\",\n        innerRadius: 0,\n        startAngle: 3 / 2,\n        tilt: 1,\n        shadow: {\n          left: 5,\n          top: 15,\n          alpha: 0.02\n        },\n\n        offset: {\n          top: 0,\n          left: \"auto\"\n        },\n        stroke: {\n          color: \"#fff\",\n          width: 1\n        },\n        label: {\n          show: \"auto\",\n          formatter: function formatter(label, slice) {\n            return \"<div style='font-size:x-small;text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n          },\n          radius: 1,\n          background: {\n            color: null,\n            opacity: 0\n          },\n          threshold: 0\n        },\n\n        combine: {\n          threshold: -1,\n          color: null,\n          label: \"Other\"\n        },\n\n        highlight: {\n          opacity: 0.5\n        }\n      }\n    }\n  };\n  $.plot.plugins.push({\n    init: init,\n    options: options,\n    name: \"pie\",\n    version: \"1.1\"\n  });\n})(jQuery);","map":{"version":3,"names":["$","REDRAW_ATTEMPTS","REDRAW_SHRINK","init","plot","canvas","target","options","maxRadius","centerLeft","centerTop","processed","ctx","highlights","hooks","processOptions","push","series","pie","show","grid","label","legend","radius","tilt","bindEvents","eventHolder","getOptions","hoverable","unbind","mousemove","onMouseMove","clickable","click","onClick","processDatapoints","data","datapoints","drawOverlay","octx","draw","newCtx","getCanvas","parent","setData","combine","getData","total","combined","numCombined","color","newdata","i","length","value","isArray","isNaN","parseFloat","isFinite","threshold","extend","angle","Math","PI","percent","canvasWidth","getPlaceholder","width","canvasHeight","height","legendWidth","children","filter","min","offset","top","left","position","match","slices","attempts","clear","drawShadow","drawPie","prepend","setSeries","insertLegend","clearRect","remove","shadowLeft","shadow","shadowTop","edge","alpha","save","translate","globalAlpha","fillStyle","scale","beginPath","arc","fill","restore","startAngle","currentAngle","drawSlice","stroke","lineWidth","drawDonutHole","drawLabels","strokeStyle","lineJoin","abs","moveTo","closePath","drawLabel","slice","index","lf","labelFormatter","text","plf","formatter","halfAngle","x","round","cos","y","sin","html","append","labelTop","labelLeft","css","background","opacity","c","pos","insertBefore","layer","innerRadius","globalCompositeOperation","isPointInPoly","poly","pt","l","j","findNearbySlice","mouseX","mouseY","s","isPointInPath","datapoint","dataIndex","seriesIndex","p1X","p1Y","p2X","p2Y","p3X","p3Y","p4X","p4Y","p5X","p5Y","arrPoly","arrPoint","e","triggerClickHoverEvent","eventname","canvasX","parseInt","pageX","canvasY","pageY","item","autoHighlight","h","auto","unhighlight","highlight","trigger","indexOfHighlight","triggerRedrawOverlay","splice","drawHighlight","plugins","name","version","jQuery"],"sources":["/Users/peterputros/Desktop/PosMate/assets/plugins/flot/jquery.flot.pie.js"],"sourcesContent":["/* Flot plugin for rendering pie charts.\r\n\r\nCopyright (c) 2007-2014 IOLA and Ole Laursen.\r\nLicensed under the MIT license.\r\n\r\nThe plugin assumes that each series has a single data value, and that each\r\nvalue is a positive integer or zero.  Negative numbers don't make sense for a\r\npie chart, and have unpredictable results.  The values do NOT need to be\r\npassed in as percentages; the plugin will calculate the total and per-slice\r\npercentages internally.\r\n\r\n* Created by Brian Medendorp\r\n\r\n* Updated with contributions from btburnett3, Anthony Aragues and Xavi Ivars\r\n\r\nThe plugin supports these options:\r\n\r\n\tseries: {\r\n\t\tpie: {\r\n\t\t\tshow: true/false\r\n\t\t\tradius: 0-1 for percentage of fullsize, or a specified pixel length, or 'auto'\r\n\t\t\tinnerRadius: 0-1 for percentage of fullsize or a specified pixel length, for creating a donut effect\r\n\t\t\tstartAngle: 0-2 factor of PI used for starting angle (in radians) i.e 3/2 starts at the top, 0 and 2 have the same result\r\n\t\t\ttilt: 0-1 for percentage to tilt the pie, where 1 is no tilt, and 0 is completely flat (nothing will show)\r\n\t\t\toffset: {\r\n\t\t\t\ttop: integer value to move the pie up or down\r\n\t\t\t\tleft: integer value to move the pie left or right, or 'auto'\r\n\t\t\t},\r\n\t\t\tstroke: {\r\n\t\t\t\tcolor: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#FFF')\r\n\t\t\t\twidth: integer pixel width of the stroke\r\n\t\t\t},\r\n\t\t\tlabel: {\r\n\t\t\t\tshow: true/false, or 'auto'\r\n\t\t\t\tformatter:  a user-defined function that modifies the text/style of the label text\r\n\t\t\t\tradius: 0-1 for percentage of fullsize, or a specified pixel length\r\n\t\t\t\tbackground: {\r\n\t\t\t\t\tcolor: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#000')\r\n\t\t\t\t\topacity: 0-1\r\n\t\t\t\t},\r\n\t\t\t\tthreshold: 0-1 for the percentage value at which to hide labels (if they're too small)\r\n\t\t\t},\r\n\t\t\tcombine: {\r\n\t\t\t\tthreshold: 0-1 for the percentage value at which to combine slices (if they're too small)\r\n\t\t\t\tcolor: any hexidecimal color value (other formats may or may not work, so best to stick with something like '#CCC'), if null, the plugin will automatically use the color of the first slice to be combined\r\n\t\t\t\tlabel: any text value of what the combined slice should be labeled\r\n\t\t\t}\r\n\t\t\thighlight: {\r\n\t\t\t\topacity: 0-1\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\nMore detail and specific examples can be found in the included HTML file.\r\n\r\n*/\r\n\r\n(function($) {\r\n\r\n\t// Maximum redraw attempts when fitting labels within the plot\r\n\r\n\tvar REDRAW_ATTEMPTS = 10;\r\n\r\n\t// Factor by which to shrink the pie when fitting labels within the plot\r\n\r\n\tvar REDRAW_SHRINK = 0.95;\r\n\r\n\tfunction init(plot) {\r\n\r\n\t\tvar canvas = null,\r\n\t\t\ttarget = null,\r\n\t\t\toptions = null,\r\n\t\t\tmaxRadius = null,\r\n\t\t\tcenterLeft = null,\r\n\t\t\tcenterTop = null,\r\n\t\t\tprocessed = false,\r\n\t\t\tctx = null;\r\n\r\n\t\t// interactive variables\r\n\r\n\t\tvar highlights = [];\r\n\r\n\t\t// add hook to determine if pie plugin in enabled, and then perform necessary operations\r\n\r\n\t\tplot.hooks.processOptions.push(function(plot, options) {\r\n\t\t\tif (options.series.pie.show) {\r\n\r\n\t\t\t\toptions.grid.show = false;\r\n\r\n\t\t\t\t// set labels.show\r\n\r\n\t\t\t\tif (options.series.pie.label.show == \"auto\") {\r\n\t\t\t\t\tif (options.legend.show) {\r\n\t\t\t\t\t\toptions.series.pie.label.show = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptions.series.pie.label.show = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// set radius\r\n\r\n\t\t\t\tif (options.series.pie.radius == \"auto\") {\r\n\t\t\t\t\tif (options.series.pie.label.show) {\r\n\t\t\t\t\t\toptions.series.pie.radius = 3/4;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptions.series.pie.radius = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// ensure sane tilt\r\n\r\n\t\t\t\tif (options.series.pie.tilt > 1) {\r\n\t\t\t\t\toptions.series.pie.tilt = 1;\r\n\t\t\t\t} else if (options.series.pie.tilt < 0) {\r\n\t\t\t\t\toptions.series.pie.tilt = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tplot.hooks.bindEvents.push(function(plot, eventHolder) {\r\n\t\t\tvar options = plot.getOptions();\r\n\t\t\tif (options.series.pie.show) {\r\n\t\t\t\tif (options.grid.hoverable) {\r\n\t\t\t\t\teventHolder.unbind(\"mousemove\").mousemove(onMouseMove);\r\n\t\t\t\t}\r\n\t\t\t\tif (options.grid.clickable) {\r\n\t\t\t\t\teventHolder.unbind(\"click\").click(onClick);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tplot.hooks.processDatapoints.push(function(plot, series, data, datapoints) {\r\n\t\t\tvar options = plot.getOptions();\r\n\t\t\tif (options.series.pie.show) {\r\n\t\t\t\tprocessDatapoints(plot, series, data, datapoints);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tplot.hooks.drawOverlay.push(function(plot, octx) {\r\n\t\t\tvar options = plot.getOptions();\r\n\t\t\tif (options.series.pie.show) {\r\n\t\t\t\tdrawOverlay(plot, octx);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tplot.hooks.draw.push(function(plot, newCtx) {\r\n\t\t\tvar options = plot.getOptions();\r\n\t\t\tif (options.series.pie.show) {\r\n\t\t\t\tdraw(plot, newCtx);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction processDatapoints(plot, series, datapoints) {\r\n\t\t\tif (!processed)\t{\r\n\t\t\t\tprocessed = true;\r\n\t\t\t\tcanvas = plot.getCanvas();\r\n\t\t\t\ttarget = $(canvas).parent();\r\n\t\t\t\toptions = plot.getOptions();\r\n\t\t\t\tplot.setData(combine(plot.getData()));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction combine(data) {\r\n\r\n\t\t\tvar total = 0,\r\n\t\t\t\tcombined = 0,\r\n\t\t\t\tnumCombined = 0,\r\n\t\t\t\tcolor = options.series.pie.combine.color,\r\n\t\t\t\tnewdata = [];\r\n\r\n\t\t\t// Fix up the raw data from Flot, ensuring the data is numeric\r\n\r\n\t\t\tfor (var i = 0; i < data.length; ++i) {\r\n\r\n\t\t\t\tvar value = data[i].data;\r\n\r\n\t\t\t\t// If the data is an array, we'll assume that it's a standard\r\n\t\t\t\t// Flot x-y pair, and are concerned only with the second value.\r\n\r\n\t\t\t\t// Note how we use the original array, rather than creating a\r\n\t\t\t\t// new one; this is more efficient and preserves any extra data\r\n\t\t\t\t// that the user may have stored in higher indexes.\r\n\r\n\t\t\t\tif ($.isArray(value) && value.length == 1) {\r\n    \t\t\t\tvalue = value[0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($.isArray(value)) {\r\n\t\t\t\t\t// Equivalent to $.isNumeric() but compatible with jQuery < 1.7\r\n\t\t\t\t\tif (!isNaN(parseFloat(value[1])) && isFinite(value[1])) {\r\n\t\t\t\t\t\tvalue[1] = +value[1];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue[1] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (!isNaN(parseFloat(value)) && isFinite(value)) {\r\n\t\t\t\t\tvalue = [1, +value];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = [1, 0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata[i].data = [value];\r\n\t\t\t}\r\n\r\n\t\t\t// Sum up all the slices, so we can calculate percentages for each\r\n\r\n\t\t\tfor (var i = 0; i < data.length; ++i) {\r\n\t\t\t\ttotal += data[i].data[0][1];\r\n\t\t\t}\r\n\r\n\t\t\t// Count the number of slices with percentages below the combine\r\n\t\t\t// threshold; if it turns out to be just one, we won't combine.\r\n\r\n\t\t\tfor (var i = 0; i < data.length; ++i) {\r\n\t\t\t\tvar value = data[i].data[0][1];\r\n\t\t\t\tif (value / total <= options.series.pie.combine.threshold) {\r\n\t\t\t\t\tcombined += value;\r\n\t\t\t\t\tnumCombined++;\r\n\t\t\t\t\tif (!color) {\r\n\t\t\t\t\t\tcolor = data[i].color;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < data.length; ++i) {\r\n\t\t\t\tvar value = data[i].data[0][1];\r\n\t\t\t\tif (numCombined < 2 || value / total > options.series.pie.combine.threshold) {\r\n\t\t\t\t\tnewdata.push(\r\n\t\t\t\t\t\t$.extend(data[i], {     /* extend to allow keeping all other original data values\r\n\t\t\t\t\t\t                           and using them e.g. in labelFormatter. */\r\n\t\t\t\t\t\t\tdata: [[1, value]],\r\n\t\t\t\t\t\t\tcolor: data[i].color,\r\n\t\t\t\t\t\t\tlabel: data[i].label,\r\n\t\t\t\t\t\t\tangle: value * Math.PI * 2 / total,\r\n\t\t\t\t\t\t\tpercent: value / (total / 100)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (numCombined > 1) {\r\n\t\t\t\tnewdata.push({\r\n\t\t\t\t\tdata: [[1, combined]],\r\n\t\t\t\t\tcolor: color,\r\n\t\t\t\t\tlabel: options.series.pie.combine.label,\r\n\t\t\t\t\tangle: combined * Math.PI * 2 / total,\r\n\t\t\t\t\tpercent: combined / (total / 100)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn newdata;\r\n\t\t}\r\n\r\n\t\tfunction draw(plot, newCtx) {\r\n\r\n\t\t\tif (!target) {\r\n\t\t\t\treturn; // if no series were passed\r\n\t\t\t}\r\n\r\n\t\t\tvar canvasWidth = plot.getPlaceholder().width(),\r\n\t\t\t\tcanvasHeight = plot.getPlaceholder().height(),\r\n\t\t\t\tlegendWidth = target.children().filter(\".legend\").children().width() || 0;\r\n\r\n\t\t\tctx = newCtx;\r\n\r\n\t\t\t// WARNING: HACK! REWRITE THIS CODE AS SOON AS POSSIBLE!\r\n\r\n\t\t\t// When combining smaller slices into an 'other' slice, we need to\r\n\t\t\t// add a new series.  Since Flot gives plugins no way to modify the\r\n\t\t\t// list of series, the pie plugin uses a hack where the first call\r\n\t\t\t// to processDatapoints results in a call to setData with the new\r\n\t\t\t// list of series, then subsequent processDatapoints do nothing.\r\n\r\n\t\t\t// The plugin-global 'processed' flag is used to control this hack;\r\n\t\t\t// it starts out false, and is set to true after the first call to\r\n\t\t\t// processDatapoints.\r\n\r\n\t\t\t// Unfortunately this turns future setData calls into no-ops; they\r\n\t\t\t// call processDatapoints, the flag is true, and nothing happens.\r\n\r\n\t\t\t// To fix this we'll set the flag back to false here in draw, when\r\n\t\t\t// all series have been processed, so the next sequence of calls to\r\n\t\t\t// processDatapoints once again starts out with a slice-combine.\r\n\t\t\t// This is really a hack; in 0.9 we need to give plugins a proper\r\n\t\t\t// way to modify series before any processing begins.\r\n\r\n\t\t\tprocessed = false;\r\n\r\n\t\t\t// calculate maximum radius and center point\r\n\r\n\t\t\tmaxRadius =  Math.min(canvasWidth, canvasHeight / options.series.pie.tilt) / 2;\r\n\t\t\tcenterTop = canvasHeight / 2 + options.series.pie.offset.top;\r\n\t\t\tcenterLeft = canvasWidth / 2;\r\n\r\n\t\t\tif (options.series.pie.offset.left == \"auto\") {\r\n\t\t\t\tif (options.legend.position.match(\"w\")) {\r\n\t\t\t\t\tcenterLeft += legendWidth / 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcenterLeft -= legendWidth / 2;\r\n\t\t\t\t}\r\n\t\t\t\tif (centerLeft < maxRadius) {\r\n\t\t\t\t\tcenterLeft = maxRadius;\r\n\t\t\t\t} else if (centerLeft > canvasWidth - maxRadius) {\r\n\t\t\t\t\tcenterLeft = canvasWidth - maxRadius;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcenterLeft += options.series.pie.offset.left;\r\n\t\t\t}\r\n\r\n\t\t\tvar slices = plot.getData(),\r\n\t\t\t\tattempts = 0;\r\n\r\n\t\t\t// Keep shrinking the pie's radius until drawPie returns true,\r\n\t\t\t// indicating that all the labels fit, or we try too many times.\r\n\r\n\t\t\tdo {\r\n\t\t\t\tif (attempts > 0) {\r\n\t\t\t\t\tmaxRadius *= REDRAW_SHRINK;\r\n\t\t\t\t}\r\n\t\t\t\tattempts += 1;\r\n\t\t\t\tclear();\r\n\t\t\t\tif (options.series.pie.tilt <= 0.8) {\r\n\t\t\t\t\tdrawShadow();\r\n\t\t\t\t}\r\n\t\t\t} while (!drawPie() && attempts < REDRAW_ATTEMPTS)\r\n\r\n\t\t\tif (attempts >= REDRAW_ATTEMPTS) {\r\n\t\t\t\tclear();\r\n\t\t\t\ttarget.prepend(\"<div class='error'>Could not draw pie with labels contained inside canvas</div>\");\r\n\t\t\t}\r\n\r\n\t\t\tif (plot.setSeries && plot.insertLegend) {\r\n\t\t\t\tplot.setSeries(slices);\r\n\t\t\t\tplot.insertLegend();\r\n\t\t\t}\r\n\r\n\t\t\t// we're actually done at this point, just defining internal functions at this point\r\n\r\n\t\t\tfunction clear() {\r\n\t\t\t\tctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n\t\t\t\ttarget.children().filter(\".pieLabel, .pieLabelBackground\").remove();\r\n\t\t\t}\r\n\r\n\t\t\tfunction drawShadow() {\r\n\r\n\t\t\t\tvar shadowLeft = options.series.pie.shadow.left;\r\n\t\t\t\tvar shadowTop = options.series.pie.shadow.top;\r\n\t\t\t\tvar edge = 10;\r\n\t\t\t\tvar alpha = options.series.pie.shadow.alpha;\r\n\t\t\t\tvar radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\r\n\r\n\t\t\t\tif (radius >= canvasWidth / 2 - shadowLeft || radius * options.series.pie.tilt >= canvasHeight / 2 - shadowTop || radius <= edge) {\r\n\t\t\t\t\treturn;\t// shadow would be outside canvas, so don't draw it\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(shadowLeft,shadowTop);\r\n\t\t\t\tctx.globalAlpha = alpha;\r\n\t\t\t\tctx.fillStyle = \"#000\";\r\n\r\n\t\t\t\t// center and rotate to starting position\r\n\r\n\t\t\t\tctx.translate(centerLeft,centerTop);\r\n\t\t\t\tctx.scale(1, options.series.pie.tilt);\r\n\r\n\t\t\t\t//radius -= edge;\r\n\r\n\t\t\t\tfor (var i = 1; i <= edge; i++) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.arc(0, 0, radius, 0, Math.PI * 2, false);\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t\tradius -= i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\r\n\t\t\tfunction drawPie() {\r\n\r\n\t\t\t\tvar startAngle = Math.PI * options.series.pie.startAngle;\r\n\t\t\t\tvar radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\r\n\r\n\t\t\t\t// center and rotate to starting position\r\n\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(centerLeft,centerTop);\r\n\t\t\t\tctx.scale(1, options.series.pie.tilt);\r\n\t\t\t\t//ctx.rotate(startAngle); // start at top; -- This doesn't work properly in Opera\r\n\r\n\t\t\t\t// draw slices\r\n\r\n\t\t\t\tctx.save();\r\n\t\t\t\tvar currentAngle = startAngle;\r\n\t\t\t\tfor (var i = 0; i < slices.length; ++i) {\r\n\t\t\t\t\tslices[i].startAngle = currentAngle;\r\n\t\t\t\t\tdrawSlice(slices[i].angle, slices[i].color, true);\r\n\t\t\t\t}\r\n\t\t\t\tctx.restore();\r\n\r\n\t\t\t\t// draw slice outlines\r\n\r\n\t\t\t\tif (options.series.pie.stroke.width > 0) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.lineWidth = options.series.pie.stroke.width;\r\n\t\t\t\t\tcurrentAngle = startAngle;\r\n\t\t\t\t\tfor (var i = 0; i < slices.length; ++i) {\r\n\t\t\t\t\t\tdrawSlice(slices[i].angle, options.series.pie.stroke.color, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// draw donut hole\r\n\r\n\t\t\t\tdrawDonutHole(ctx);\r\n\r\n\t\t\t\tctx.restore();\r\n\r\n\t\t\t\t// Draw the labels, returning true if they fit within the plot\r\n\r\n\t\t\t\tif (options.series.pie.label.show) {\r\n\t\t\t\t\treturn drawLabels();\r\n\t\t\t\t} else return true;\r\n\r\n\t\t\t\tfunction drawSlice(angle, color, fill) {\r\n\r\n\t\t\t\t\tif (angle <= 0 || isNaN(angle)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (fill) {\r\n\t\t\t\t\t\tctx.fillStyle = color;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.strokeStyle = color;\r\n\t\t\t\t\t\tctx.lineJoin = \"round\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tif (Math.abs(angle - Math.PI * 2) > 0.000000001) {\r\n\t\t\t\t\t\tctx.moveTo(0, 0); // Center of the pie\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//ctx.arc(0, 0, radius, 0, angle, false); // This doesn't work properly in Opera\r\n\t\t\t\t\tctx.arc(0, 0, radius,currentAngle, currentAngle + angle / 2, false);\r\n\t\t\t\t\tctx.arc(0, 0, radius,currentAngle + angle / 2, currentAngle + angle, false);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\t//ctx.rotate(angle); // This doesn't work properly in Opera\r\n\t\t\t\t\tcurrentAngle += angle;\r\n\r\n\t\t\t\t\tif (fill) {\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction drawLabels() {\r\n\r\n\t\t\t\t\tvar currentAngle = startAngle;\r\n\t\t\t\t\tvar radius = options.series.pie.label.radius > 1 ? options.series.pie.label.radius : maxRadius * options.series.pie.label.radius;\r\n\r\n\t\t\t\t\tfor (var i = 0; i < slices.length; ++i) {\r\n\t\t\t\t\t\tif (slices[i].percent >= options.series.pie.label.threshold * 100) {\r\n\t\t\t\t\t\t\tif (!drawLabel(slices[i], currentAngle, i)) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcurrentAngle += slices[i].angle;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\tfunction drawLabel(slice, startAngle, index) {\r\n\r\n\t\t\t\t\t\tif (slice.data[0][1] == 0) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// format label text\r\n\r\n\t\t\t\t\t\tvar lf = options.legend.labelFormatter, text, plf = options.series.pie.label.formatter;\r\n\r\n\t\t\t\t\t\tif (lf) {\r\n\t\t\t\t\t\t\ttext = lf(slice.label, slice);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = slice.label;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (plf) {\r\n\t\t\t\t\t\t\ttext = plf(text, slice);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar halfAngle = ((startAngle + slice.angle) + startAngle) / 2;\r\n\t\t\t\t\t\tvar x = centerLeft + Math.round(Math.cos(halfAngle) * radius);\r\n\t\t\t\t\t\tvar y = centerTop + Math.round(Math.sin(halfAngle) * radius) * options.series.pie.tilt;\r\n\r\n\t\t\t\t\t\tvar html = \"<span class='pieLabel' id='pieLabel\" + index + \"' style='position:absolute;top:\" + y + \"px;left:\" + x + \"px;'>\" + text + \"</span>\";\r\n\t\t\t\t\t\ttarget.append(html);\r\n\r\n\t\t\t\t\t\tvar label = target.children(\"#pieLabel\" + index);\r\n\t\t\t\t\t\tvar labelTop = (y - label.height() / 2);\r\n\t\t\t\t\t\tvar labelLeft = (x - label.width() / 2);\r\n\r\n\t\t\t\t\t\tlabel.css(\"top\", labelTop);\r\n\t\t\t\t\t\tlabel.css(\"left\", labelLeft);\r\n\r\n\t\t\t\t\t\t// check to make sure that the label is not outside the canvas\r\n\r\n\t\t\t\t\t\tif (0 - labelTop > 0 || 0 - labelLeft > 0 || canvasHeight - (labelTop + label.height()) < 0 || canvasWidth - (labelLeft + label.width()) < 0) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (options.series.pie.label.background.opacity != 0) {\r\n\r\n\t\t\t\t\t\t\t// put in the transparent background separately to avoid blended labels and label boxes\r\n\r\n\t\t\t\t\t\t\tvar c = options.series.pie.label.background.color;\r\n\r\n\t\t\t\t\t\t\tif (c == null) {\r\n\t\t\t\t\t\t\t\tc = slice.color;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar pos = \"top:\" + labelTop + \"px;left:\" + labelLeft + \"px;\";\r\n\t\t\t\t\t\t\t$(\"<div class='pieLabelBackground' style='position:absolute;width:\" + label.width() + \"px;height:\" + label.height() + \"px;\" + pos + \"background-color:\" + c + \";'></div>\")\r\n\t\t\t\t\t\t\t\t.css(\"opacity\", options.series.pie.label.background.opacity)\r\n\t\t\t\t\t\t\t\t.insertBefore(label);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} // end individual label function\r\n\t\t\t\t} // end drawLabels function\r\n\t\t\t} // end drawPie function\r\n\t\t} // end draw function\r\n\r\n\t\t// Placed here because it needs to be accessed from multiple locations\r\n\r\n\t\tfunction drawDonutHole(layer) {\r\n\t\t\tif (options.series.pie.innerRadius > 0) {\r\n\r\n\t\t\t\t// subtract the center\r\n\r\n\t\t\t\tlayer.save();\r\n\t\t\t\tvar innerRadius = options.series.pie.innerRadius > 1 ? options.series.pie.innerRadius : maxRadius * options.series.pie.innerRadius;\r\n\t\t\t\tlayer.globalCompositeOperation = \"destination-out\"; // this does not work with excanvas, but it will fall back to using the stroke color\r\n\t\t\t\tlayer.beginPath();\r\n\t\t\t\tlayer.fillStyle = options.series.pie.stroke.color;\r\n\t\t\t\tlayer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);\r\n\t\t\t\tlayer.fill();\r\n\t\t\t\tlayer.closePath();\r\n\t\t\t\tlayer.restore();\r\n\r\n\t\t\t\t// add inner stroke\r\n\r\n\t\t\t\tlayer.save();\r\n\t\t\t\tlayer.beginPath();\r\n\t\t\t\tlayer.strokeStyle = options.series.pie.stroke.color;\r\n\t\t\t\tlayer.arc(0, 0, innerRadius, 0, Math.PI * 2, false);\r\n\t\t\t\tlayer.stroke();\r\n\t\t\t\tlayer.closePath();\r\n\t\t\t\tlayer.restore();\r\n\r\n\t\t\t\t// TODO: add extra shadow inside hole (with a mask) if the pie is tilted.\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//-- Additional Interactive related functions --\r\n\r\n\t\tfunction isPointInPoly(poly, pt) {\r\n\t\t\tfor(var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i)\r\n\t\t\t\t((poly[i][1] <= pt[1] && pt[1] < poly[j][1]) || (poly[j][1] <= pt[1] && pt[1]< poly[i][1]))\r\n\t\t\t\t&& (pt[0] < (poly[j][0] - poly[i][0]) * (pt[1] - poly[i][1]) / (poly[j][1] - poly[i][1]) + poly[i][0])\r\n\t\t\t\t&& (c = !c);\r\n\t\t\treturn c;\r\n\t\t}\r\n\r\n\t\tfunction findNearbySlice(mouseX, mouseY) {\r\n\r\n\t\t\tvar slices = plot.getData(),\r\n\t\t\t\toptions = plot.getOptions(),\r\n\t\t\t\tradius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius,\r\n\t\t\t\tx, y;\r\n\r\n\t\t\tfor (var i = 0; i < slices.length; ++i) {\r\n\r\n\t\t\t\tvar s = slices[i];\r\n\r\n\t\t\t\tif (s.pie.show) {\r\n\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(0, 0); // Center of the pie\r\n\t\t\t\t\t//ctx.scale(1, options.series.pie.tilt);\t// this actually seems to break everything when here.\r\n\t\t\t\t\tctx.arc(0, 0, radius, s.startAngle, s.startAngle + s.angle / 2, false);\r\n\t\t\t\t\tctx.arc(0, 0, radius, s.startAngle + s.angle / 2, s.startAngle + s.angle, false);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tx = mouseX - centerLeft;\r\n\t\t\t\t\ty = mouseY - centerTop;\r\n\r\n\t\t\t\t\tif (ctx.isPointInPath) {\r\n\t\t\t\t\t\tif (ctx.isPointInPath(mouseX - centerLeft, mouseY - centerTop)) {\r\n\t\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tdatapoint: [s.percent, s.data],\r\n\t\t\t\t\t\t\t\tdataIndex: 0,\r\n\t\t\t\t\t\t\t\tseries: s,\r\n\t\t\t\t\t\t\t\tseriesIndex: i\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// excanvas for IE doesn;t support isPointInPath, this is a workaround.\r\n\r\n\t\t\t\t\t\tvar p1X = radius * Math.cos(s.startAngle),\r\n\t\t\t\t\t\t\tp1Y = radius * Math.sin(s.startAngle),\r\n\t\t\t\t\t\t\tp2X = radius * Math.cos(s.startAngle + s.angle / 4),\r\n\t\t\t\t\t\t\tp2Y = radius * Math.sin(s.startAngle + s.angle / 4),\r\n\t\t\t\t\t\t\tp3X = radius * Math.cos(s.startAngle + s.angle / 2),\r\n\t\t\t\t\t\t\tp3Y = radius * Math.sin(s.startAngle + s.angle / 2),\r\n\t\t\t\t\t\t\tp4X = radius * Math.cos(s.startAngle + s.angle / 1.5),\r\n\t\t\t\t\t\t\tp4Y = radius * Math.sin(s.startAngle + s.angle / 1.5),\r\n\t\t\t\t\t\t\tp5X = radius * Math.cos(s.startAngle + s.angle),\r\n\t\t\t\t\t\t\tp5Y = radius * Math.sin(s.startAngle + s.angle),\r\n\t\t\t\t\t\t\tarrPoly = [[0, 0], [p1X, p1Y], [p2X, p2Y], [p3X, p3Y], [p4X, p4Y], [p5X, p5Y]],\r\n\t\t\t\t\t\t\tarrPoint = [x, y];\r\n\r\n\t\t\t\t\t\t// TODO: perhaps do some mathmatical trickery here with the Y-coordinate to compensate for pie tilt?\r\n\r\n\t\t\t\t\t\tif (isPointInPoly(arrPoly, arrPoint)) {\r\n\t\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tdatapoint: [s.percent, s.data],\r\n\t\t\t\t\t\t\t\tdataIndex: 0,\r\n\t\t\t\t\t\t\t\tseries: s,\r\n\t\t\t\t\t\t\t\tseriesIndex: i\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove(e) {\r\n\t\t\ttriggerClickHoverEvent(\"plothover\", e);\r\n\t\t}\r\n\r\n\t\tfunction onClick(e) {\r\n\t\t\ttriggerClickHoverEvent(\"plotclick\", e);\r\n\t\t}\r\n\r\n\t\t// trigger click or hover event (they send the same parameters so we share their code)\r\n\r\n\t\tfunction triggerClickHoverEvent(eventname, e) {\r\n\r\n\t\t\tvar offset = plot.offset();\r\n\t\t\tvar canvasX = parseInt(e.pageX - offset.left);\r\n\t\t\tvar canvasY =  parseInt(e.pageY - offset.top);\r\n\t\t\tvar item = findNearbySlice(canvasX, canvasY);\r\n\r\n\t\t\tif (options.grid.autoHighlight) {\r\n\r\n\t\t\t\t// clear auto-highlights\r\n\r\n\t\t\t\tfor (var i = 0; i < highlights.length; ++i) {\r\n\t\t\t\t\tvar h = highlights[i];\r\n\t\t\t\t\tif (h.auto == eventname && !(item && h.series == item.series)) {\r\n\t\t\t\t\t\tunhighlight(h.series);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// highlight the slice\r\n\r\n\t\t\tif (item) {\r\n\t\t\t\thighlight(item.series, eventname);\r\n\t\t\t}\r\n\r\n\t\t\t// trigger any hover bind events\r\n\r\n\t\t\tvar pos = { pageX: e.pageX, pageY: e.pageY };\r\n\t\t\ttarget.trigger(eventname, [pos, item]);\r\n\t\t}\r\n\r\n\t\tfunction highlight(s, auto) {\r\n\t\t\t//if (typeof s == \"number\") {\r\n\t\t\t//\ts = series[s];\r\n\t\t\t//}\r\n\r\n\t\t\tvar i = indexOfHighlight(s);\r\n\r\n\t\t\tif (i == -1) {\r\n\t\t\t\thighlights.push({ series: s, auto: auto });\r\n\t\t\t\tplot.triggerRedrawOverlay();\r\n\t\t\t} else if (!auto) {\r\n\t\t\t\thighlights[i].auto = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction unhighlight(s) {\r\n\t\t\tif (s == null) {\r\n\t\t\t\thighlights = [];\r\n\t\t\t\tplot.triggerRedrawOverlay();\r\n\t\t\t}\r\n\r\n\t\t\t//if (typeof s == \"number\") {\r\n\t\t\t//\ts = series[s];\r\n\t\t\t//}\r\n\r\n\t\t\tvar i = indexOfHighlight(s);\r\n\r\n\t\t\tif (i != -1) {\r\n\t\t\t\thighlights.splice(i, 1);\r\n\t\t\t\tplot.triggerRedrawOverlay();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction indexOfHighlight(s) {\r\n\t\t\tfor (var i = 0; i < highlights.length; ++i) {\r\n\t\t\t\tvar h = highlights[i];\r\n\t\t\t\tif (h.series == s)\r\n\t\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tfunction drawOverlay(plot, octx) {\r\n\r\n\t\t\tvar options = plot.getOptions();\r\n\r\n\t\t\tvar radius = options.series.pie.radius > 1 ? options.series.pie.radius : maxRadius * options.series.pie.radius;\r\n\r\n\t\t\toctx.save();\r\n\t\t\toctx.translate(centerLeft, centerTop);\r\n\t\t\toctx.scale(1, options.series.pie.tilt);\r\n\r\n\t\t\tfor (var i = 0; i < highlights.length; ++i) {\r\n\t\t\t\tdrawHighlight(highlights[i].series);\r\n\t\t\t}\r\n\r\n\t\t\tdrawDonutHole(octx);\r\n\r\n\t\t\toctx.restore();\r\n\r\n\t\t\tfunction drawHighlight(series) {\r\n\r\n\t\t\t\tif (series.angle <= 0 || isNaN(series.angle)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//octx.fillStyle = parseColor(options.series.pie.highlight.color).scale(null, null, null, options.series.pie.highlight.opacity).toString();\r\n\t\t\t\toctx.fillStyle = \"rgba(255, 255, 255, \" + options.series.pie.highlight.opacity + \")\"; // this is temporary until we have access to parseColor\r\n\t\t\t\toctx.beginPath();\r\n\t\t\t\tif (Math.abs(series.angle - Math.PI * 2) > 0.000000001) {\r\n\t\t\t\t\toctx.moveTo(0, 0); // Center of the pie\r\n\t\t\t\t}\r\n\t\t\t\toctx.arc(0, 0, radius, series.startAngle, series.startAngle + series.angle / 2, false);\r\n\t\t\t\toctx.arc(0, 0, radius, series.startAngle + series.angle / 2, series.startAngle + series.angle, false);\r\n\t\t\t\toctx.closePath();\r\n\t\t\t\toctx.fill();\r\n\t\t\t}\r\n\t\t}\r\n\t} // end init (plugin body)\r\n\r\n\t// define pie specific options and their default values\r\n\r\n\tvar options = {\r\n\t\tseries: {\r\n\t\t\tpie: {\r\n\t\t\t\tshow: false,\r\n\t\t\t\tradius: \"auto\",\t// actual radius of the visible pie (based on full calculated radius if <=1, or hard pixel value)\r\n\t\t\t\tinnerRadius: 0, /* for donut */\r\n\t\t\t\tstartAngle: 3/2,\r\n\t\t\t\ttilt: 1,\r\n\t\t\t\tshadow: {\r\n\t\t\t\t\tleft: 5,\t// shadow left offset\r\n\t\t\t\t\ttop: 15,\t// shadow top offset\r\n\t\t\t\t\talpha: 0.02\t// shadow alpha\r\n\t\t\t\t},\r\n\t\t\t\toffset: {\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t\tleft: \"auto\"\r\n\t\t\t\t},\r\n\t\t\t\tstroke: {\r\n\t\t\t\t\tcolor: \"#fff\",\r\n\t\t\t\t\twidth: 1\r\n\t\t\t\t},\r\n\t\t\t\tlabel: {\r\n\t\t\t\t\tshow: \"auto\",\r\n\t\t\t\t\tformatter: function(label, slice) {\r\n\t\t\t\t\t\treturn \"<div style='font-size:x-small;text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\r\n\t\t\t\t\t},\t// formatter function\r\n\t\t\t\t\tradius: 1,\t// radius at which to place the labels (based on full calculated radius if <=1, or hard pixel value)\r\n\t\t\t\t\tbackground: {\r\n\t\t\t\t\t\tcolor: null,\r\n\t\t\t\t\t\topacity: 0\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthreshold: 0\t// percentage at which to hide the label (i.e. the slice is too narrow)\r\n\t\t\t\t},\r\n\t\t\t\tcombine: {\r\n\t\t\t\t\tthreshold: -1,\t// percentage at which to combine little slices into one larger slice\r\n\t\t\t\t\tcolor: null,\t// color to give the new slice (auto-generated if null)\r\n\t\t\t\t\tlabel: \"Other\"\t// label to give the new slice\r\n\t\t\t\t},\r\n\t\t\t\thighlight: {\r\n\t\t\t\t\t//color: \"#fff\",\t\t// will add this functionality once parseColor is available\r\n\t\t\t\t\topacity: 0.5\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t$.plot.plugins.push({\r\n\t\tinit: init,\r\n\t\toptions: options,\r\n\t\tname: \"pie\",\r\n\t\tversion: \"1.1\"\r\n\t});\r\n\r\n})(jQuery);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}